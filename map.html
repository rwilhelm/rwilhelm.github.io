<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Deutschland</title>
  <script src="https://d3js.org/d3.v5.js"></script>
  <script src="https://unpkg.com/topojson@3"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <style type="text/css">
    body {
      margin: 0;
    }

    .main {
      height: 100%;
    }

    .svg-container {
      display: inline-block;
      position: relative;
      width: 100%;
      padding-bottom: 100%;
      vertical-align: top;
      overflow: hidden;
    }

    .svg-content {
      display: inline-block;
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>

<body>
  <div id="main" class="svg-container"></div>
</body>

<script>

  const colorBy = (d, region) => {
    return d.properties.NAME_2
  }

  const margin = { top: 50, right: 50, bottom: 50, left: 50 }
  let { width, height } = d3.select('#main').node().getBoundingClientRect();

  width = width - margin.left - margin.right
  height = height - margin.top - margin.bottom;

  const svg = d3.select("#main")
    .append("svg")
    .attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 1111 1111")
    .classed("svg-content", true)
    .append("g")
  // .attr("transform",
  // "translate(" + margin.left + "," + margin.top + ")")

  // d3.json("https://raw.githubusercontent.com/rwilhelm/deutschlandGeoJSON/master/2_bundeslaender/1_sehr_hoch.geojson").then(data => {
  d3.json("https://raw.githubusercontent.com/rwilhelm/deutschlandGeoJSON/master/3_regierungsbezirke/3_mittel.geojson").then(data => {
    console.log(data)

    var topology = topojson.topology({ foo: data });
    var geojson = topojson.feature(topology, topology.objects.foo)
    var features = geojson.features;

    const projection = d3.geoEqualEarth()
      .fitExtent([
        [margin.left, margin.top],
        [1000, 1000]
      ], geojson)

    var path = d3.geoPath().projection(projection);
    var drawPath = path(topojson.mesh(topology, topology.objects.foo, (a, b) => a !== b));

    var myColor = d3.scaleOrdinal().domain(['a', 'b'])
      .range(d3.schemeSet3);

    svg.append("rect")
      .attr("width", "100%")
      .attr("height", "100%")
      .attr("fill", "#d7d7d7");

    svg.append("g")
      .attr("cursor", "crosshair")
      .selectAll("path")
      .data(features)
      .join("path")
      .attr("stroke", "#ccc") // color boundaries 1
      .attr("fill", "#4a4a4a") // color areas
      .attr("d", path)
      .on("mouseenter", (d, i) => {
        console.log(d.properties);

        // d3.select(d3.event.target).attr("fill", "#789FEA")
        d3.select(d3.event.target).attr("fill", myColor)

        svg.append("text")
          .attr('id', "label" + i)
          .attr("x", width - 444)
          .attr("y", height / 2 + margin.top - 20)
          .attr("dy", ".35em")
          .text(d.properties.NAME_1 + " | " + d.properties.NAME_2);

      })
      .on("mouseleave", (d, i) => {
        d3.select(d3.event.target).attr("fill", "#4a4a4a")
        d3.select("#label" + i).remove();
      })

    svg.select("g").append("path")
      .attr("stroke", "#ccc") // color boundaries 2
      .attr("fill", "none")
      .attr("stroke-linejoin", "round")
      .attr("d", drawPath)

  })

</script>

</html>